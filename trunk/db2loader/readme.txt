
УСТАНОВКА
=========

1. Установите Jre 6.0.02. Можно развернуть из jre1.6.0_02.rar в папку C:\Program Files\Java.
2. Если у вас не установлен DB2 клиент
	2.1. Разархивируйте db2_jars.rar в C:\Program Files\Java.
	2.2. Убедитесь что в переменной CLASSPATH прописаны пути до следующих jar:
		CLASSPATH=
			.;
			C:\Program Files\java\db2java.zip;
			C:\Program Files\java\db2jcc.jar;
			C:\Program Files\java\sqlj.zip;
			C:\Program Files\java\db2jcc_license_cisuz.jar;
			C:\Program Files\java\db2jcc_license_cu.jar;
			C:\Program Files\java\common.jar;
			c:\Program Files\Java\jre1.6.0_02\lib\charsets.jar;

3. Если установлен DB2 клиент
	2.1. Убедитесь что в переменной CLASSPATH прописаны пути до следующих jar:
		CLASSPATH=
			.;
			C:\PROGRA~1\IBM\SQLLIB\java\db2java.zip;
			C:\PROGRA~1\IBM\SQLLIB\java\db2jcc.jar;
			C:\PROGRA~1\IBM\SQLLIB\java\sqlj.zip;
			C:\PROGRA~1\IBM\SQLLIB\java\db2jcc_license_cisuz.jar;
			C:\PROGRA~1\IBM\SQLLIB\java\db2jcc_license_cu.jar;
			C:\PROGRA~1\IBM\SQLLIB\java\common.jar;
			c:\Program Files\Java\jre1.6.0_02\lib\charsets.jar;

4. Убедитесь что в переменной PATH прописан путь c:\Program Files\Java\jre1.6.0_02\bin.
5. Удалите c:\WINDOWS\system32\java.exe во избежание конфликтов.
6. Разархивируйте install.rar в каталог установки.
7. Добавьте в переменную CLASSPATH каталог установки.

В результате установки будут созданы следующие файлы и каталоги:

 |-bin\
 |  |-data\				- каталог для загруженных данных.
 |  |-log\				- каталог логов работы загрузчика.
 |  |-all.bat				- командный файл для загрузки всех ежедневных данных.
 |  |-bundling.bat			- загрузка комплектаций (запрашиваются процедуры SBDSP057, SBDSP058, SBDSP059).
 |  |-cuts_passports.bat		- загрузка паспортов отцепок (запрашивается процедура GSPNRP1B)
 |  |-delta_passports.bat		- загрузка изменений паспортов выпущенных вагонов (запрашивается процедура GSPVAGS3)
 |  |-repair_passports.bat		- загрузка паспортов выпусков (запрашивается процедура GSPNRP1B)
 |  |-wag_operations.bat		- загрузка операций с вагонами (запрашивается процедура GSPNRP1B)
 |- classes
 |  |-loader.class
 |  |-Data.class
 |  |-Db.class
 |  |-JdbcException.class
 |-readme.txt


ИСПОЛЬЗОВАНИЕ ЗАГРУЗЧИКА
========================

Запустите командную строку.
Наберите:
	java loader <alias> <host> <port> <user> <password> <parameters>, где:
		alias - алиас базы данных,
		host - адрес сервера,
		port - порт сервера,
		user - имя пользователя,
		password - пароль пользователя,
		parameters - параметры загрузки:
			-o<output file> - имя файля для выгрузки данных (если не указан, данные будут выводиться в stdout).
			-l<log file> - имя файля для сдужебных сообщений (если не указан, данные будут выводиться в stderr).
			-w<wagon file> - имя файля с перечнем номеров вагонов.
			-h<number> - кол-во строк заголовка в файле, указанном параметром -w.
			-p<proc_name> - полное имя процедуры (<schema>.<procedure>).
			-t<result table name> - имя таблицы с результирующим набором данных.
			-i<int_proc_param> - числовой параметр процедуры.
			-s<string_proc_param> - строковый параметр процедуры. 
				Внутри строкового параметра может быть указаны шаблоны %d и %y:
					%d[<n>(d|m|y)] - текущая дата в формате yyyy-MM-dd. 
						<n> - количество дней (d), месяцев (m), лет (y) ранее от текущей даты,
							например, -s%d[1d] - вчерашняя дата (текущая минус один день)
					%y - год в формате yyyy, например -s%y - текущий год.

			-ri - выходной числовой параметр процедуры.
			-rs - выходной строковый параметр процедуры.

Примеры:
	выгрузка данных в файл out.txt из процедуры d90.gvcpst01 с 9-ю входными параметрами и одним числовым выходным:
	java loader LOCP 10.200.8.1 5021 DESVOC01 DESV5066 -oout.txt -pd90.gvcpst01 -i2 -i3 -s(83000) -i0 -i4 -s() -i0 -s1 -s() -ri


ЗАГРУЗКА ЕЖЕДНЕВНЫХ ДАННЫХ
==========================

Для загрузки ежедневных данных запустите командный файл <каталог_установки_загрузчика>/bin/all.bat.
В результате в каталог <каталог_установки_загрузчика>/bin/data будут загружены следующие файлы:
	bundling_telega_<дата>.csv	- изменения комплектации тележек для выпущенных вагонов.
	bundling_kolesa_<дата>.csv	- изменения комплектации колесных пар для выпущенных вагонов.
	bundling_lit_det_<дата>.csv	- изменения комплектации литых деталей для выпущенных вагонов.
	wag_operations_<дата>.csv	- операции с вагоном.
	repair_passports_<дата>.csv	- паспорта выпусков.
	cuts_passports_<дата>.csv	- паспорта отцепок.
	delta_passports_<дата>.csv	- изменения в паспортах выпущенных вагонов.
Логи работы загрузчика сохраняются в каталоге <каталог_установки_загрузчика>/bin/log.
Если в результате загрузки данных произошли ошибки, файл данных не сохраняется. Ошибка регистрируется в log-файле.
